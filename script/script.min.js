import{GIFEncoder as e}from"/gifenc/dist/gifenc.esm.js";let t,n,a,i,o,r,s,d,l,c,u=S(),m="",h=0,g=F();const p=[[255,109,0],[255,219,0],[182,255,0],[73,255,0],[0,255,36],[0,255,146],[0,255,255],[0,146,255],[0,36,255],[73,0,255],[182,0,255],[255,0,219],[255,0,109],[255,0,0]],f=["calibri","cascadiamono","chiller","comicsansms","consolas","cooperblack","copperplateblack","couriernew","digital7","futura","harlowsolid","helvetica","impact","itcavantgardegothic","jmhtypewriter","jokerman","kenteken","minecrafter","papyrus","qrfont","rijksoverheid","univers","wingdings"],_=window.speechSynthesis,v=document.getElementById("input-text"),w=document.getElementById("input-submit"),y=document.getElementById("input-color"),E=document.getElementById("input-rainbow"),b=document.getElementById("input-rainbow-label"),L=document.getElementById("input-warning"),I=document.getElementById("loader"),x=document.getElementById("output"),k=document.getElementById("progress-bar"),M=document.getElementById("output-gif"),$=document.getElementById("output-anchor"),B=document.getElementById("output-save"),T=document.getElementById("header"),A=document.getElementById("background"),C=document.getElementsByTagName("main")[0],j=document.querySelector("link[rel='icon']");function F(){const e=Math.round(360*Math.random()),t=Math.round(50*Math.random()+50),n=`hsl(${e}, ${t}%, 50%)`;function a(e){const t=e.toString(16);return 1===t.length?"0"+t:t}const i=function(e,t,n){n/=100;const a=t=>(t+e/30)%12,i=(t/=100)*Math.min(n,1-n),o=e=>n-i*Math.max(-1,Math.min(a(e)-3,Math.min(9-a(e),1)));return[255*o(0),255*o(8),255*o(4)]}(e,t,50).map((e=>Math.round(e)));return{hsl:n,rgb:i,hex:"#"+a(i[0])+a(i[1])+a(i[2])}}function P(){if(!A)return clearInterval(d);if(A.childElementCount>=u)return clearInterval(d);const e=document.createElement("div");e.classList.add("soepkip"),e.ondragstart=()=>!1,e.ariaHidden="true",e.innerText=A.childElementCount%2?"kip":"soep",e.classList.add(D(f)),D([!0,!1,!1])&&e.classList.add("bold"),D([!0,!1,!1])&&e.classList.add("italic"),D([!0,!1,!1])&&e.classList.add("underlined"),e.classList.add(D(["lowercase","uppercase","capitalize"])),e.style.fontSize=(3*Math.random()+.8).toFixed(2)+"em",D([!0,!1])?e.style.color=F().hsl:e.style.backgroundColor=F().hsl,e.style.color||e.classList.add(D(["white","black"])),D([!0,!1])?e.style.left=(100*Math.random()).toFixed(3)+"%":e.style.right=(100*Math.random()).toFixed(3)+"%",D([!0,!1])?e.style.top=(100*Math.random()).toFixed(3)+"%":e.style.bottom=(100*Math.random()).toFixed(3)+"%",A.append(e);const t=e.getBoundingClientRect(),n=t.left+t.width/2>innerWidth/2?"right":"left";e.dataset.side=n,e.onclick=R}async function R(e){if(new Audio(`/media/${e.target.innerText.toLowerCase()}.mp3`).play(),await z(e.target),0!==A.childElementCount)return;const t=document.createElement("video");t.src="/media/je-bent-een-soepkip.mp4",t.autoplay=!0,t.controls=!1,t.muted=!1,t.style.position="fixed",t.style.zIndex=2,t.style.width="100%",t.style.height="100%",t.style.objectFit="fill",t.style.cursor="none",document.body.append(t)}function z(e){return e.classList.add(`slide-to-the-${e.dataset.side}`),new Promise(((t,n)=>{setTimeout((()=>{e.remove(),t()}),1e3)}))}function S(){return Math.round(innerWidth*innerHeight/1300)}function D(e){return e[Math.floor(Math.random()*e.length)]}function U(e){e.preventDefault();const t=parseInt(C.dataset.translateX||0)+e.movementX,n=parseInt(C.dataset.translateY||0)+e.movementY;C.dataset.translateX=t,C.dataset.translateY=n,C.style.transform=`translate(${t}px, ${n}px)`}function X(e){j.href=e[h],h=h<13?h+1:0}document.documentElement.style.setProperty("--accent-color",g.hsl),y&&(y.value=g.hex),setInterval((()=>{g=F(),document.documentElement.style.setProperty("--accent-color",g.hsl)}),1e3),setInterval((()=>{console.clear();["      _/_/_/    _/_/    _/_/_/_/  _/_/_/    _/    _/  _/_/_/  _/_/_/                      _/_/    ","   _/        _/    _/  _/        _/    _/  _/  _/      _/    _/    _/      _/      _/  _/    _/   ","    _/_/    _/    _/  _/_/_/    _/_/_/    _/_/        _/    _/_/_/        _/      _/      _/      ","       _/  _/    _/  _/        _/        _/  _/      _/    _/              _/  _/      _/         ","_/_/_/      _/_/    _/_/_/_/  _/        _/    _/  _/_/_/  _/                _/      _/_/_/_/      "].forEach(((e,t)=>{setTimeout((()=>{console.info(e)}),150*(t+1))}))}),1e4),d=setInterval(P,75),w?.addEventListener("click",(async function(){clearInterval(d);const l=A.children;for(let e=0;e<A.childElementCount;e++)z(l[e]);t=function(){if(!/^[A-Za-z!? .$&@\d]*$/.test(v.value))return;T.hidden=!0,x.hidden=!0,v.disabled=!0,w.disabled=!0,y.disabled=!0,E.disabled=!0,s&&URL.revokeObjectURL(s);k.max=15,k.value=0,I.hidden=!1;const e=v.value.toLowerCase(),t=parseInt(y.value.replace("#",""),16),a=[t>>16&255,t>>8&255,255&t],i=E.checked;return n=a[0]<16&&a[1]>239&&a[2]<16?[0,0,255]:[0,255,0],{text:e,color:a,rainbow:i}}(),a=function(){const e={};for(const n of t.text)if(!e[n]){const t=new Image;t.src=`/media/letters/arg-${n.replaceAll("?","_")}-0.png`,e[n]=t}return e}(),i=await async function(){const e=[],i=document.createElement("canvas"),o=i.getContext("2d",{willReadFrequently:!0});let r=0,s=0;for(const e of t.text)await a[e].decode(),r+=a[e].width/14,s=a[e].height>s?a[e].height:s;i.width=r,i.height=s;for(let d=0;d<14;d++){let l;o.fillStyle=`rgb(${n[0]}, ${n[1]}, ${n[2]})`,o.fillRect(0,0,r,s);let c=0;for(let e=0;e<t.text.length;e++){const n=t.text[e],r=a[n],s=t.rainbow?p[(d+e)%14]:t.color,l=s.map((e=>Math.round(.8*e))),u=r.width/14*d,m=0,h=r.width/14,g=r.height,f=c,_=i.height-r.height,v=r.width/14,w=r.height;o.drawImage(r,u,m,h,g,f,_,v,w);const y=o.getImageData(f,_,v,w);for(let e=0;e<y.data.length;e+=4){const t=y.data[e],n=y.data[e+1],a=y.data[e+2],i=y.data[e+3];240===t&&0===n&&0===a&&255===i&&(y.data[e]=s[0],y.data[e+1]=s[1],y.data[e+2]=s[2]),192===t&&0===n&&0===a&&255===i&&(y.data[e]=l[0],y.data[e+1]=l[1],y.data[e+2]=l[2])}o.putImageData(y,f,_),c+=r.width/14}l=o.getImageData(0,0,i.width,i.height),e.push(l)}return k.value++,e}(),o=function(){const e=[[0,0,0],[0,240,80],[144,80,192],[208,128,0],[255,255,255]];t.rainbow?p.forEach((t=>{e.push(t),e.push(t.map((e=>Math.round(.8*e))))})):(e.push(t.color),e.push(t.color.map((e=>Math.round(.8*e)))));return e.unshift(n),e}(),r=await async function(){const t=await a(4);for(let e=0;e<i.length;e++){const n=i[e].data;t.addFrame(n,e),await new Promise((e=>setTimeout(e,0)))}const n=await t.finish();return n instanceof Blob?n:new Blob([n],{type:"image/gif"});async function a(t){const n=i[0].width,a=i[0].height,r=new Array(t).fill(null).map((()=>new Worker("/script/worker.min.js",{type:"module"})));let s=0;r.forEach((e=>{e.postMessage({event:"init",format:"rgb444",delay:250,width:n,height:a,palette:o})})),await Promise.all(r.map((e=>l(e))));const d=e({auto:!1});return{addFrame(e,t){const n=r[s++%r.length];n.postMessage([e,t],[e.buffer]),i[t]=c(n,t).then((e=>{const[t,n]=e.data;return k.value++,t}))},async finish(){const e=await Promise.all(i);d.writeHeader();for(let t=0;t<e.length;t++)d.stream.writeBytesView(e[t]);return d.finish(),r.forEach((e=>e.terminate())),r.length=0,d.bytesView()}};function l(e){return new Promise((t=>{const n=a=>{"ready"===a.data&&(e.removeEventListener("message",n),t(a))};e.addEventListener("message",n,{passive:!0})}))}function c(e,t){return new Promise((n=>{const a=i=>{i.data[1]===t&&(e.removeEventListener("message",a),n(i))};e.addEventListener("message",a,{passive:!0})}))}}}(),s=URL.createObjectURL(r),M.alt=`dansende letters die '${t.text}' uitspellen`,M.src=s,M.title=t.text,$.download=t.text.replaceAll("?","").replaceAll(".","").trim().replaceAll(" ","-"),$.href=s,I.hidden=!0,v.disabled=!1,w.disabled=!1,y.disabled=!1,E.disabled=!1,x.hidden=!1,v.select(),d=setInterval(P,75)})),window.addEventListener("resize",(function(e){u=S(),clearInterval(d),d=setInterval(P,75)})),B?.addEventListener("click",(function(e){$.click()})),v?.addEventListener("keypress",(function(e){"Enter"===e.key&&w.click()})),v?.addEventListener("input",(function(e){if(!e.data)return;if(!/^[A-Za-z!? .$&@\d]*$/.test(e.data))return;const t=e.data.toLowerCase().replaceAll("?","_");m.includes(t)||(fetch(`/media/letters/arg-${t}-0.png`),m+=t)})),v?.addEventListener("input",(function(e){if(""===this.value)return w.disabled=!0,void(L.hidden=!0);if(!/^[A-Za-z!? .$&@\d]*$/.test(this.value)){w.disabled=!0;let e="";for(let t of this.value.matchAll(/[^A-Za-z!? .$&@\d]/g))e+=t[0];return L.innerText=`'${e}' niet toegestaan`,void(L.hidden=!1)}w.disabled=!1,L.hidden=!0})),E?.addEventListener("input",(function(e){const t=this.checked;for(let e=b.children.length-1;e>=0;e--)setTimeout((()=>{t?b.children[e].classList.add("rainbow"):b.children[e].classList.remove("rainbow")}),250*(b.children.length-e))})),y?.addEventListener("input",(function(e){colorLabel.style.color=this.value,document.documentElement.style.setProperty("--accent-color",this.value)})),C.addEventListener("mousedown",(function(e){e.target.classList.contains("draggable")&&(e.preventDefault(),C.addEventListener("mousemove",U))})),window.addEventListener("mouseup",(function(e){C.removeEventListener("mousemove",U)})),window.addEventListener("touchmove",(function(e){e.changedTouches[0].target.classList.contains("draggable")&&(clearTimeout(c),l&&(e.movementX=e.changedTouches[0].pageX-l.pageX,e.movementY=e.changedTouches[0].pageY-l.pageY,U(e)),l=e.changedTouches[0],c=setTimeout((()=>{l=void 0}),300))})),w?.addEventListener("click",(function(e){const n=new SpeechSynthesisUtterance(t.text);_.speak(n)})),async function(){const e=[],t=document.createElement("canvas"),n=t.getContext("2d");t.width=64,t.height=64;const a=new Image;a.src="/media/favicon-anim.png",await a.decode();for(let i=0;i<14;i++)n.clearRect(0,0,t.width,t.height),n.drawImage(a,64*i,0,64,64,0,0,64,64),e.push(t.toDataURL("image/png"));return e}().then((e=>setInterval(X,500,e)));